# Visited count

## Структура проекта

В проекте содержаться 4 основных папки:

* bin - баш скрипты для запуска
* cfg - тестовая конфигурация для Redis
* src - искодные коды на Python
* test - файлы тестов

## Запуск

Для запуска сервера сначала нужно запустить `redis-server` на вашем устройстве.

### Сервер

Далее через скрипт `bin/run-server.sh` мы запускаем http сервер, который будет обрабатывать
наши запросы. По умолчанию сервер запускается на `localhost` и на порту `8080`, но это
изменить аргументами при вызове скрипта (порядок соответствует перечислению выше). После
запуска, сервер переходит входит в бесконечный цикл считывания запросов, что бы остановить
и сделать снапшот в Redis, следует нажать `Ctrl + C`.

### Клиент

Для запуска клиента необходимо запустить скрипт `bin/run-client.sh`, далее окно перейдет в
бесконечный цикл с появляющимися инструкциями. По умолчанию клиент отправляет запросы на
`localhost:8080`, это также можно изменить аргументами при вызове скрипта (порядок
соответсвенный). Клиент можно запустить для отправки одного запроса, для этого необходимо
использовать аргументы при вызове скрипта: после указания адреса хоста и порта нужно прописать
название метода (`GET` или `POST`). При использовании `GET` необходимо далее передать 2
аргумента - начало и конец временного интервала. Если вы вызываете `POST` необходимо указать
json, который будет отправлен запросом.

## Тестирование

Для запуска тестов необходимо без аргументов запустить `bin/run-test.sh`. Важно, что
предварительно нужно запустить сервер. Если все успешно, то после названием каждого
теста появится `OK`.

### Добавление тестов

Для того, что бы добавить тесты, необходимо создать файл с расширение `.tst` в папку `test/testcases`.
По своей сути - это набор переменных, которые мы задаем сами. Все переменные, которые можно задать:

* `METHOD` - метод (`GET` или `POST`)
* `ARGS` - аргументы при отправке запроса (при использовании `GET`, значения перечислятся через пробел)
* `OUT` - ожидаемый ответ сервера
* `ADDRESS` - адрес сервера (хост и порт указывать вместе через пробел)
* `POST_EXPECTED` - ожидаемый ответ от сервера, при отправке тестирующих данных на сервер (рекомендуется
не менять)

Для тестирования `GET` запросов нам необходимы данные на сервере и время их появления там.
Для этого в тестирующей системе предусмотрен механизм предварительных `POST` запросов.
Т. е. Вы отправляете на сервер данные и уже знаете, когда они там появились. Для этого
необходимо в папку `/test/postdata` добавить файл с расширением `.pst`, который будет
выглядеть так - `DATA='{\"links\":[...]}'`. Т. е. это те данные, которые до тестирования будет
отправлены на сервер и время их отправки будет храниться в массиве `DATETIMES`. Первым и
последним элементом являются время начала отправки запросов и время конца соответственно,
все остальные элементы являются временами отправки данных каждого файла. Файлы отправляются
в порядке возрастания (названия).
